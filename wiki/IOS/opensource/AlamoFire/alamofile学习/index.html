<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    
    <title>AlamoFire 源码浅析 | LJ小窝</title>
    
    
        <meta name="keywords" content="AlamoFire">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="AlamoFire 学习">
<meta name="keywords" content="AlamoFire">
<meta property="og:type" content="article">
<meta property="og:title" content="AlamoFire 源码浅析">
<meta property="og:url" content="http://yoursite.com/wiki/IOS/opensource/AlamoFire/alamofile学习/index.html">
<meta property="og:site_name" content="LJ小窝">
<meta property="og:description" content="AlamoFire 学习">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-12-17T09:36:31.304Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AlamoFire 源码浅析">
<meta name="twitter:description" content="AlamoFire 学习">
    

    
        <link rel="alternate" href="/atom.xml" title="LJ小窝" type="application/atom+xml">
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">
    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>
</html>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">LJ小窝</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">首页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="/about">关于</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索">
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id="categories">
        <h3 class="widget-title">
            <span>分类</span>
            &nbsp;
            <a id="allExpand" href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            C++语言
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            C++Primer
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第七章类
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第七章类/类/">类</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第三章 字符串、向量、数组
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第三章 字符串、向量、数组/字符串、向量、数组/">字符串、向量、数组</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第九章顺序容器
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第九章顺序容器/顺序容器/">顺序容器</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第二章变量和基本类型
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第二章变量和基本类型/变量和基本类型/">变量和基本类型</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第八章io库
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第八章io库/IO库/">IO库</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第六章函数
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第六章函数/函数/">函数</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第十三章
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第十三章/拷贝控制/">拷贝控制</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第十九章特殊工具和技术
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第十九章特殊工具和技术/特殊工具和技术/">特殊工具和技术</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第十二章 动态内存
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第十二章 动态内存/动态内存/">动态内存</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第十五章 面向对象程序设计
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第十五章 面向对象程序设计/面向对象程序设计/">面向对象程序设计</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第十六章 模板和泛型编程
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第十六章 模板和泛型编程/模板和泛型编程/">模板和泛型编程</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第十四章
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第十四章/重载运算与类型转换/">重载运算与类型转换</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第十章 泛型算法
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第十章 泛型算法/泛型算法/">泛型算法</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第四章 表达式
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/第四章 表达式/表达式/">表达式</a></li>  <li class="file"><a href="/wiki/C++语言/C++Primer/第四章 表达式/运算符优先级表/">运算符优先级表</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            附录
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++Primer/附录/关键字使用的位置/">关键字使用的位置</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            C++关键字理解
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/C++关键字理解/explicit-learn/">explicit实例浅析(转载)</a></li>  <li class="file"><a href="/wiki/C++语言/C++关键字理解/static/">static关键字作用总结(转载)</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            STL源码剖析
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第二章
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/STL源码剖析/第二章/空间配置器/">空间配置器</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第四章
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/STL源码剖析/第四章/deque/">deque</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            container
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            deque
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/container/deque/deque的实现原理和使用方法详解/">deque的实现原理和使用方法详解</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            list
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C++语言/container/list/C++标准库中的list的实现原理/">C++标准库中的list的实现原理</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/C++语言/container/forward_list不支持push_back操作/">为什么`forward_list`不支持`push_back`操作？</a></li>  <li class="file"><a href="/wiki/C++语言/container/容器基本操作/">容器基本操作</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            C语言语法
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/C语言语法/CC_pointer_memry/">二级指针动态申请内存</a></li>  <li class="file"><a href="/wiki/C语言语法/struct_Analize/">struct定义语法</a></li>  <li class="file"><a href="/wiki/C语言语法/union定义/">union定义(转载)</a></li>  <li class="file"><a href="/wiki/C语言语法/堆区（heap）和栈区（stack）的区别/">堆区（heap）和栈区（stack）的区别(转载)</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Hybird
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            webview
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/Hybird/webview/WKWebview/">通用webview开发记录</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            weex
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            桌面移动过来的资料
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            weex 文档
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/Hybird/weex/桌面移动过来的资料/weex 文档/国美weex使用教程/"></a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/Hybird/weex/event-analize/">weex 事件原理分析</a></li>  <li class="file"><a href="/wiki/Hybird/weex/Weex_six_events/">weex系列抄之一---事件处理</a></li>  <li class="file"><a href="/wiki/Hybird/weex/weex-conmunication/">weex 通信原理分析</a></li>  <li class="file"><a href="/wiki/Hybird/weex/weex_one/">weex系列抄之一---环境搭建</a></li>  <li class="file"><a href="/wiki/Hybird/weex/weex-debug/">搭建weex断点调试环境</a></li>  <li class="file"><a href="/wiki/Hybird/weex/weex_four/">weex系列抄之四---flex 布局</a></li>  <li class="file"><a href="/wiki/Hybird/weex/weex_two/">weex系列抄之二---weex原理</a></li>  <li class="file"><a href="/wiki/Hybird/weex/Weex_five/">weex系列抄之四---由 FlexBox 算法强力驱动的 Weex 布局引擎</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            IOS
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            ABTest
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            ABTest
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/ABTest/ABTest/ABTest/">ABTest IOS SDK设计</a></li>  <li class="file"><a href="/wiki/IOS/ABTest/ABTest/about/"></a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Block
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/Block/block/">Block的本质</a></li>  <li class="file"><a href="/wiki/IOS/Block/block_getCapture/">获取Block捕获的变量</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            IOS12
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/IOS12/IOS12-compatibility/">IOS12 兼容</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            MachO
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/MachO/MachO_FileStructure/">Mach-O文件结构理解</a></li>  <li class="file"><a href="/wiki/IOS/MachO/machoviewer/">mach-o Viewer 源码学习</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Runtime
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            objc
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/Runtime/objc/11_load/">11. 你真的了解 load 方法么？</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/10_load_images/">10.load_images 函数分析</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/0_refer/">0. 参考资料</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/13_class_initialize/">13. _class_initialize 源码分析</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/12_initialize/">12. 懒惰的 initialize 方法（转载）</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/15_autoreleasepool/">15. 自动释放池的前世今生（转载)</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/16_retain_release/">16. retain 和 release（转载)</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/14_AssociatedObject /">14. 关联对象 AssociatedObject 完全解析（转载)</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/17_weak/">17. weak 相关源码分析</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/18_syncsize/">18. @synchronized</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/1_NSObject_isa/">1. 从 NSObject 的初始化了解 isa（转载)</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/2_NSObject_objc_object/">2. class_data_bits_t 结构</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/3NSObject/">3. NSObject 基本完整类图</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/4entsize_list_tt/">4. 方法列表entsize_list_tt结构</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/6_NXHashTable/">6. 上古时代 Objective-C 中哈希表的实现(转载)</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/5list_array_tt/">5. list_array_tt 结构详解</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/8__objc_init/">8. objc4入口函数</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/7_NXMapTable/">7. NXMapTable数据结构</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/objc/9__read_images/">9. _read_images 从二进制文件中读取类信息</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            日常总结
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/Runtime/日常总结/method_swizzing/">方法交换理解</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            神经病院Objective-C Runtime入院系列文章
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/Runtime/神经病院Objective-C Runtime入院系列文章/secondDay/">第二天--消息发送与转发（转载)</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/神经病院Objective-C Runtime入院系列文章/firstDay/">第一天--isa和Class(转载)</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/神经病院Objective-C Runtime入院系列文章/thirdDay/">第三天——如何正确使用Runtime(转载)</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            经典文章
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/Runtime/经典文章/meta_class/">Objective-C 中的元类（meta class）是什么？</a></li>  <li class="file"><a href="/wiki/IOS/Runtime/经典文章/Objective_C_Category/">深入理解Objective-C：Category(转载)</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/IOS/Runtime/reffer/">学习runtime的参考文档</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            crash
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/crash/1_system_Crash_Type/">1. 系统Crash日志结构介绍</a></li>  <li class="file"><a href="/wiki/IOS/crash/4_increase_Wild_Pointer/">4.如何定位Obj-C野指针随机Crash(一):先提高野指针Crash率(转载)</a></li>  <li class="file"><a href="/wiki/IOS/crash/2_Collection_Crash/">2. 收集崩溃日志方法</a></li>  <li class="file"><a href="/wiki/IOS/crash/5_increase_Wild_Pointer/">5. 如何定位Obj-C野指针随机Crash(二):让非必现Crash变成必现(转载)</a></li>  <li class="file"><a href="/wiki/IOS/crash/3_KSCrash_Analize/">3. KSCrash原理浅析</a></li>  <li class="file"><a href="/wiki/IOS/crash/6_increase_Wild_Pointer/">6. 如何定位Obj-C野指针随机Crash(三)：加点黑科技让Crash自报家门(转载)</a></li>  <li class="file"><a href="/wiki/IOS/crash/7_increase_Wild_Pointer/">7. Scribble& NSZombieEnabled</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            foundation使用记录
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/foundation使用记录/NSInvocation的基本使/">NSInvocation的基本使用</a></li>  <li class="file"><a href="/wiki/IOS/foundation使用记录/NSDateFormatter时间格式/">NSDateFormatter 时间格式</a></li>  <li class="file"><a href="/wiki/IOS/foundation使用记录/NSScaner/">NSScanner</a></li>  <li class="file"><a href="/wiki/IOS/foundation使用记录/NSURL记录/">NSURL记录</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            opensource
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            AFNetworking
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/opensource/AFNetworking/AFNetworking/">AFNetworking 源码浅析</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            AlamoFire
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file active"><a href="/wiki/IOS/opensource/AlamoFire/alamofile学习/">AlamoFire 源码浅析</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Aspects
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/opensource/Aspects/aspect/">aspect源码浅析</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            JLRoute
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/opensource/JLRoute/JLRoute/">JLRoute学习</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            fishhook
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/opensource/fishhook/fishHookPicture/">图解fishhook</a></li>  <li class="file"><a href="/wiki/IOS/opensource/fishhook/learn_fishhook/">fishhook学习记录</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            logan
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/opensource/logan/logan/">logan 源码浅析</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            swiftUI
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/swiftUI/swiftUI/">Swift新特性</a></li>  <li class="file"><a href="/wiki/IOS/swiftUI/swiftUI_DataFlow/">SwiftUI 数据流理解</a></li>  <li class="file"><a href="/wiki/IOS/swiftUI/swiftUI_Share/">SwiftUI 分享内容</a></li>  <li class="file"><a href="/wiki/IOS/swiftUI/swiftUI_Share的副本/"></a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            swift语言
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            swift学习摘要
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/10__类和结构体/">10. 类和结构体</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/11__属性/">11. 属性</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/12__方法/">12. 方法</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/13__下标/">13. 下标</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/15__构造过程/">15. 构造过程</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/14__继承/">14. 继承</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/17__可选链/">17. 可选链</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/16__析构过程/">16. 析构过程</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/18__错误处理/">18. 错误处理</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/19__类型转换/">19. 类型转换</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/21__扩展/">21. 扩展</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/22__协议/">22. 协议</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/20__嵌套类型/">20. 嵌套类型</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/23__泛型/">23. 泛型</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/24__自动引用计数器/">24. 自动引用计数器</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/2__基础/">2. 基础</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/8__闭包/">7. 函数</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/9__枚举/">1. 枚举</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/swift学习摘要/7__函数/">7. 函数</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            小码哥视频学习记录
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/swift语言/小码哥视频学习记录/13 汇编分析String、Array的结构/">13 汇编分析String、Array的结构</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/小码哥视频学习记录/11 协议/">协议</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/小码哥视频学习记录/12 错误处理 /">错误处理</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/小码哥视频学习记录/14 枚举的本质、溢出运算符/">14 枚举的本质、溢出运算符</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/小码哥视频学习记录/18 swift OC/">18 swift OC 混合编程</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/小码哥视频学习记录/3/">枚举</a></li>  <li class="file"><a href="/wiki/IOS/swift语言/小码哥视频学习记录/2/">枚举</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/IOS/swift语言/swift使用经验/">swift 使用经验</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            事件处理
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/事件处理/event/">iOS事件处理看我就够了(转载)</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            内存管理
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/内存管理/内存学习/">内存学习</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            动态库
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/动态库/static_lib_aggregate_script/">合并真机模拟器静态库(转载)</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            多线程
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/多线程/GCD_Source/">GCD源码理解</a></li>  <li class="file"><a href="/wiki/IOS/多线程/NSOperaionQueue/">NSOperaionQueue 源码学习</a></li>  <li class="file"><a href="/wiki/IOS/多线程/NSOperation/">NSOperation</a></li>  <li class="file"><a href="/wiki/IOS/多线程/referr/">多线程参考资料</a></li>  <li class="file"><a href="/wiki/IOS/多线程/use-dispatch-semaphore/">dispatch_semaphore 的使用方法</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            小码哥视频
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/小码哥视频/ios_jalebroke/">小码哥视频学习记录</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            库
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/库/组件化-库/">组件化-库</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            暂无分类
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/暂无分类/ios_sign/">iOS App 签名的原理([抄袭的，有问题请联系](http://wereadteam.github.io/2017/03/13/Signature/))</a></li>  <li class="file"><a href="/wiki/IOS/暂无分类/指定初始化函数/">正确使用NS_DESIGNATED_INITIALIZER</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            虚拟内存
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/虚拟内存/虚拟内存之2/">查看虚拟内存</a></li>  <li class="file"><a href="/wiki/IOS/虚拟内存/虚拟内存/">虚拟内存之一----关于</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            黑夜模式
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/IOS/黑夜模式/支持黑夜模式/">Supporting Dark Mode in Your Interface（支持黑夜模式）</a></li>  <li class="file"><a href="/wiki/IOS/黑夜模式/选择明确的样式/">Choosing a Specific Interface Style for Your iOS App（选择明确的界面样式）</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            JS
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/JS/flexBox/">flexBox 伸缩盒子模型</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            linux命令
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/linux命令/export命令/">export命令</a></li>  <li class="file"><a href="/wiki/linux命令/set命令/">set命令</a></li>  <li class="file"><a href="/wiki/linux命令/特殊参数/">linux shell下的特殊用法及参数的说明</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            工具
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Cocoapods
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/工具/Cocoapods/Cocoapods-new-spec/">Cocoapods-new-spec</a></li>  <li class="file"><a href="/wiki/工具/Cocoapods/cocoapod-learn-install/">cocoapod学习 安装和使用（1）</a></li>  <li class="file"><a href="/wiki/工具/Cocoapods/cocoapod-private-repo/">创建私有仓库</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            IOS模拟器安装app
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/工具/IOS模拟器安装app/IOS_simulator_install_app/">给IOS模拟器按照APP</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Xcode编译常量
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/工具/Xcode编译常量/xcode编译环境变量/">Xcode编译环境变量</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            git
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            git简略版
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/工具/git/git简略版/git简略版/">Git笔记</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            git详细记录
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/工具/git/git详细记录/git仓库/">Git仓库(转载)</a></li>  <li class="file"><a href="/wiki/工具/git/git详细记录/git分支管理/">Git分支管理(转载)</a></li>  <li class="file"><a href="/wiki/工具/git/git详细记录/git工作区/">git时光穿梭(转载)</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            hexo
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/工具/hexo/LaTex/">支持LaTEX的hexo博客</a></li>  <li class="file"><a href="/wiki/工具/hexo/hexo-use/">hexo使用指南</a></li>  <li class="file"><a href="/wiki/工具/hexo/自己搭建博客的经历/">自己搭建博客的经历</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            markdowm
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/工具/markdowm/Markdown公式编辑学习笔记/">Markdown公式编辑</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            ruby
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/工具/ruby/homebrew-gem使用/">homebrew-gem使用.</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            工具下载地址
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/工具/工具下载地址/工具下载地址/">工具下载地址</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/工具/use_appledoc/">appledoc生成文档实践</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            数学知识
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            概率论与数理统计(同济十二五)
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/数学知识/概率论与数理统计(同济十二五)/第一章随机事件与概率/">第一章 基本知识</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            概率论和数理统计
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/数学知识/概率论和数理统计/第一章 概率论的基本概念/">第一章 基本知识</a></li>  <li class="file"><a href="/wiki/数学知识/概率论和数理统计/第二章 随机变量及其分布/">第二章 随机变量及其分布</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            线性代数
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/数学知识/线性代数/det/">第一章行列式</a></li>  <li class="file"><a href="/wiki/数学知识/线性代数/matrix/">第二章矩阵</a></li>  <li class="file"><a href="/wiki/数学知识/线性代数/matrixTransformation/">第三章 矩阵的初等变换和线性方程组</a></li>  <li class="file"><a href="/wiki/数学知识/线性代数/vector/">第四章 向量组的线性相关性</a></li>  <li class="file"><a href="/wiki/数学知识/线性代数/相似矩阵/">第五章 相似矩阵</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            高数
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/数学知识/高数/four_indefinite_integral/">第四章 不定积分</a></li>  <li class="file"><a href="/wiki/数学知识/高数/定积分/">定积分</a></li>  <li class="file"><a href="/wiki/数学知识/高数/函数与极限/">第一章 函数与极限</a></li>  <li class="file"><a href="/wiki/数学知识/高数/导数与微分/">第二章导数与微分</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/数学知识/数学基础知识/">数学知识一对数指数</a></li>  <li class="file"><a href="/wiki/数学知识/经典数学文章/">经典数学文章</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            数据结构与算法
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            LeetCode
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            top1_10
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/数据结构与算法/LeetCode/top1_10/1_两数之和/">1. 两数之和</a></li>  <li class="file"><a href="/wiki/数据结构与算法/LeetCode/top1_10/3_无重复字符的最长子串/">1. 两数之和</a></li>  <li class="file"><a href="/wiki/数据结构与算法/LeetCode/top1_10/5_最长回文子串/">1. 两数之和</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/数据结构与算法/LeetCode/206_链表反转/">206. 链表反转</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            数据结构和算法之美
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/数据结构与算法/数据结构和算法之美/34_KMP/">KMP字符串查找</a></li>  <li class="file"><a href="/wiki/数据结构与算法/数据结构和算法之美/36_AC自动机/">AC自动机多模式匹配</a></li>  <li class="file"><a href="/wiki/数据结构与算法/数据结构和算法之美/38_分治思想/">分治思想</a></li>  <li class="file"><a href="/wiki/数据结构与算法/数据结构和算法之美/39_回溯思想/">39_回溯思想</a></li>  <li class="file"><a href="/wiki/数据结构与算法/数据结构和算法之美/40_初识动态规划/">40_初识动态规划</a></li>  <li class="file"><a href="/wiki/数据结构与算法/数据结构和算法之美/41_动态规划理论/">41_动态规划理论</a></li>  <li class="file"><a href="/wiki/数据结构与算法/数据结构和算法之美/42_动态规划实战/">42_动态规划实战</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            算法4
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第4章图
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/数据结构与算法/算法4/第4章图/4.1 无向图/">4.1 无向图</a></li>  <li class="file"><a href="/wiki/数据结构与算法/算法4/第4章图/4.2 有向图/">4.2 有向图</a></li>  <li class="file"><a href="/wiki/数据结构与算法/算法4/第4章图/4.3 最小生成树/">4.3 最小生成树</a></li>  <li class="file"><a href="/wiki/数据结构与算法/算法4/第4章图/4.4 最短路径/">4.4 最短路径</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            第5章字符串
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/数据结构与算法/算法4/第5章字符串/5_2_search/">单词查找数</a></li>  <li class="file"><a href="/wiki/数据结构与算法/算法4/第5章字符串/5_1_sort/">字符串排序</a></li>  <li class="file"><a href="/wiki/数据结构与算法/算法4/第5章字符串/5_3_findSubString/">子字符串查找</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/数据结构与算法/算法4/about/">算法4</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            编程理论
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            OAuth 2.0
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/编程理论/OAuth 2.0/OAuth/">理解OAuth</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            SSH
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/编程理论/SSH/ssh-theory/">图解SSH原理</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            mmap
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/编程理论/mmap/union定义的副本/">mmap原理之详解(转载)</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            人脸登录
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/编程理论/人脸登录/faceLogin/">刷脸登录调研</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            正则表达式
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/编程理论/正则表达式/正则表达式学习/">正则表达式学习摘要</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            英语
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/英语/英语单词/">英语单词</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            资料收集
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            notice
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/资料收集/notice/notice/">注意事项</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/资料收集/学习资源/">学习计划&资源</a></li>  </ul> 
                    </li> 
                     </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-IOS/opensource/AlamoFire/alamofile学习" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/IOS/">IOS</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/IOS/opensource/">opensource</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/IOS/opensource/AlamoFire/">AlamoFire</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/AlamoFire/">AlamoFire</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/IOS/opensource/AlamoFire/alamofile学习/">
            <time datetime="2019-12-15T10:07:12.000Z" itemprop="datePublished">2019-12-15</time>
        </a>
    </div>


                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            AlamoFire 源码浅析
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
                <div id="toc" class="toc-article">
                <strong class="toc-title">文章目录</strong>
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、AlamoFire-使用"><span class="toc-number">1.</span> <span class="toc-text">一、AlamoFire 使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、-AF命名空间"><span class="toc-number">2.</span> <span class="toc-text">二、 AF命名空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、-URLConvertible"><span class="toc-number">3.</span> <span class="toc-text">三、 URLConvertible</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求方式"><span class="toc-number">4.</span> <span class="toc-text">请求方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编码器"><span class="toc-number">5.</span> <span class="toc-text">编码器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#URLEncoding-类"><span class="toc-number">5.1.</span> <span class="toc-text">URLEncoding 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSONEncoding"><span class="toc-number">5.2.</span> <span class="toc-text">JSONEncoding</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拦截器部分（RequestInterceptor适配、重试）"><span class="toc-number">6.</span> <span class="toc-text">拦截器部分（RequestInterceptor适配、重试）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestAdapter-协议"><span class="toc-number">6.1.</span> <span class="toc-text">RequestAdapter 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Result-表示结果的枚举"><span class="toc-number">6.2.</span> <span class="toc-text">Result 表示结果的枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RetryResult重试枚举"><span class="toc-number">6.3.</span> <span class="toc-text">RetryResult重试枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestRetrier协议"><span class="toc-number">6.4.</span> <span class="toc-text">RequestRetrier协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestInterceptor-协议"><span class="toc-number">6.5.</span> <span class="toc-text">RequestInterceptor 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Adapter-类"><span class="toc-number">6.6.</span> <span class="toc-text">Adapter 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Retrier-类"><span class="toc-number">6.7.</span> <span class="toc-text">Retrier 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Interceptor类"><span class="toc-number">6.8.</span> <span class="toc-text">Interceptor类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ServerTrustManager–服务信任管理"><span class="toc-number">7.</span> <span class="toc-text">ServerTrustManager–服务信任管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ServerTrustEvaluating-评估器协议"><span class="toc-number">7.1.</span> <span class="toc-text">ServerTrustEvaluating 评估器协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DefaultTrustEvaluator"><span class="toc-number">7.2.</span> <span class="toc-text">DefaultTrustEvaluator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RevocationTrustEvaluator-类"><span class="toc-number">7.3.</span> <span class="toc-text">RevocationTrustEvaluator  类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PinnedCertificatesTrustEvaluator"><span class="toc-number">7.4.</span> <span class="toc-text">PinnedCertificatesTrustEvaluator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PublicKeysTrustEvaluator"><span class="toc-number">7.5.</span> <span class="toc-text">PublicKeysTrustEvaluator</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RedirectHandler-–-重定向处理"><span class="toc-number">8.</span> <span class="toc-text">RedirectHandler – 重定向处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redirector-结构体"><span class="toc-number">8.1.</span> <span class="toc-text">Redirector 结构体</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CachedResponseHandler-缓存协议"><span class="toc-number">9.</span> <span class="toc-text">CachedResponseHandler 缓存协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ResponseCacher-结构体"><span class="toc-number">9.1.</span> <span class="toc-text">ResponseCacher 结构体</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RequestDelegate-请求代理"><span class="toc-number">10.</span> <span class="toc-text">RequestDelegate 请求代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SessionStateProvider"><span class="toc-number">10.1.</span> <span class="toc-text">SessionStateProvider</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小小节"><span class="toc-number">10.2.</span> <span class="toc-text">小小节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#序列化响应"><span class="toc-number">11.</span> <span class="toc-text">序列化响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DataResponseSerializerProtocol-协议"><span class="toc-number">11.1.</span> <span class="toc-text">DataResponseSerializerProtocol 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DownloadResponseSerializerProtocol-协议"><span class="toc-number">11.2.</span> <span class="toc-text">DownloadResponseSerializerProtocol 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResponseSerializer"><span class="toc-number">11.3.</span> <span class="toc-text">ResponseSerializer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DataPreprocessor-数据预处理器"><span class="toc-number">11.4.</span> <span class="toc-text">DataPreprocessor 数据预处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResponseSerializer-协议扩展"><span class="toc-number">11.5.</span> <span class="toc-text">ResponseSerializer  协议扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DataRequest-在序列化文件中的扩展"><span class="toc-number">11.6.</span> <span class="toc-text">DataRequest 在序列化文件中的扩展</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Request"><span class="toc-number">12.</span> <span class="toc-text">Request</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#初始状态部分"><span class="toc-number">12.1.</span> <span class="toc-text">初始状态部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可变状态部分"><span class="toc-number">12.2.</span> <span class="toc-text">可变状态部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#进度部分"><span class="toc-number">12.3.</span> <span class="toc-text">进度部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重定向、缓存"><span class="toc-number">12.4.</span> <span class="toc-text">重定向、缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#response"><span class="toc-number">12.5.</span> <span class="toc-text">response</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task"><span class="toc-number">12.6.</span> <span class="toc-text">task</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内部功能"><span class="toc-number">12.7.</span> <span class="toc-text">内部功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证响应"><span class="toc-number">12.8.</span> <span class="toc-text">验证响应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Protector"><span class="toc-number">13.</span> <span class="toc-text">Protector</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session"><span class="toc-number">14.</span> <span class="toc-text">session</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RequestTaskMap"><span class="toc-number">15.</span> <span class="toc-text">RequestTaskMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extended命名作用域"><span class="toc-number">16.</span> <span class="toc-text">Extended命名作用域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#学习到的知识"><span class="toc-number">17.</span> <span class="toc-text">学习到的知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OptionSet"><span class="toc-number">17.1.</span> <span class="toc-text">OptionSet</span></a></li></ol></li></ol>
                </div>
            
        
        
            <p>AlamoFire 学习</p>
<a id="more"></a>
<h2 id="一、AlamoFire-使用"><a href="#一、AlamoFire-使用" class="headerlink" title="一、AlamoFire 使用"></a>一、AlamoFire 使用</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///创建一个请求</span></span><br><span class="line">let request = AF.request(<span class="string">"https://httpbin.org/post"</span>, method: .post)</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加一个完成Block，序列化器序列的类型String</span></span><br><span class="line">request<span class="selector-class">.responseString</span> &#123; response <span class="keyword">in</span></span><br><span class="line">                requestComplete(response<span class="selector-class">.response</span>, response.result)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>下面是两个函数的定义</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">request</span><span class="params">(<span class="number">_</span> url: URLConvertible,</span></span></span><br><span class="line"><span class="function"><span class="params">                               method: HTTPMethod = .<span class="keyword">get</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                               parameters: Parameters? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                               encoding: ParameterEncoding = URLEncoding.<span class="keyword">default</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                               headers: HTTPHeaders? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                               interceptor: RequestInterceptor? = <span class="literal">nil</span>)</span></span> -&gt; <span class="type">DataRequest</span> </span><br><span class="line">                               </span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">responseString</span><span class="params">(queue: DispatchQueue = .main,</span></span></span><br><span class="line"><span class="function"><span class="params">                               encoding: String.Encoding? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                               completionHandler: @escaping <span class="params">(AFDataResponse&lt;String&gt;)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Self</span></span><br></pre></td></tr></table></figure>
<p>首先我定的策略是农村包围城市，先了解request函数的参数中使用的类型，完事后，再进入函数体内部，了解原理。</p>
<h2 id="二、-AF命名空间"><a href="#二、-AF命名空间" class="headerlink" title="二、 AF命名空间"></a>二、 AF命名空间</h2><p>Alamofire是入口文件，文件中定义了一个枚举，充当命名空间的作用。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">AF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> version = <span class="string">"5.0.0-rc.3"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">request</span><span class="params">(<span class="number">_</span> url: URLConvertible,</span></span></span><br><span class="line"><span class="function"><span class="params">                               method: HTTPMethod = .<span class="keyword">get</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                               parameters: Parameters? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                               encoding: ParameterEncoding = URLEncoding.<span class="keyword">default</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                               headers: HTTPHeaders? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                               interceptor: RequestInterceptor? = <span class="literal">nil</span>)</span></span> -&gt; <span class="type">DataRequest</span> &#123;</span><br><span class="line">                               ....</span><br><span class="line">                               &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用的时候调用AF.request。防止request和其他的request冲突，包装在AF中，起到命名空间的作用。</p>
<h2 id="三、-URLConvertible"><a href="#三、-URLConvertible" class="headerlink" title="三、 URLConvertible"></a>三、 URLConvertible</h2><p>URLConvertible 是一个协议。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">URLConvertible</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">asURL</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">URL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个协议的作用是创建一个URL对象。并且String、URL、URLComponents结构都遵守了这个协议，那么， 好处是什么呢？</p>
<p>扩大了参数的类型，也就是说可以给request方法传递String、URL、URLComponents类型的参数，函数内部使用asURL方法统一获取URL对象。</p>
<h2 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h2><p>请求方式定义为HTTPMethod结构体类型，封装了请求的方式。</p>
<h2 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h2><p>编码器定义一个协议，所有的编码器准守改协议 – ParameterEncoding</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">ParameterEncoding</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(<span class="number">_</span> urlRequest: URLRequestConvertible, with parameters: Parameters?)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">URLRequest</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该协议定义了如何将请求参数编码到请求urlRequest中。</p>
<p>alamofire中定义了URLEncoding、JSONEncoding两种编码器实现了ParameterEncoding协议。</p>
<h3 id="URLEncoding-类"><a href="#URLEncoding-类" class="headerlink" title="URLEncoding 类"></a>URLEncoding 类</h3><p>遵守ParameterEncoding协议，创建基于url-encoded的查询串，设置或添加到URL上，或者HTTP的body中。对于集合类型的参数如何编码，没有公开的规范，所以对于数组编码为形如foo[]=1&amp;foo[]=2的格式，字典形如foo[bar]=baz格式。可以通过ArrayEncoding删除中括号，BoolEncoding可以配置布尔值如何编码(比如true 1，false 0)</p>
<p>一、Destination 枚举 </p>
<p>url编码的查询串是否添加到已有查询串，还是添加到HTTP Body中</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">enum</span> <span class="title">Destination</span> &#123;</span></span><br><span class="line">        /<span class="regexp">//</span> GET、HEAD、DELETE 查询，其他的请求放在Body中</span><br><span class="line">        <span class="keyword">case</span> methodDependent</span><br><span class="line">        <span class="keyword">case</span> queryString</span><br><span class="line">        <span class="keyword">case</span> httpBody</span><br><span class="line">        func encodesParametersInURL(<span class="keyword">for</span> <span class="symbol">method:</span> HTTPMethod) -&gt; Bool &#123;</span><br><span class="line">            switch <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="symbol">methodDependent:</span> <span class="keyword">return</span> [.get, .head, .delete].contains(method)</span><br><span class="line">            <span class="keyword">case</span> .<span class="symbol">queryString:</span> <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">case</span> .<span class="symbol">httpBody:</span> <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>二、 ArrayEncoding 枚举 </p>
<p>配置Array参数如何编码</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">enum</span> <span class="title">ArrayEncoding</span> &#123;</span></span><br><span class="line">        <span class="keyword">case</span> brackets</span><br><span class="line">        <span class="keyword">case</span> noBrackets</span><br><span class="line">        func encode(<span class="symbol">key:</span> String) -&gt; String &#123;</span><br><span class="line">            switch <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="symbol">brackets:</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">"\(key)[]"</span></span><br><span class="line">            <span class="keyword">case</span> .<span class="symbol">noBrackets:</span></span><br><span class="line">                <span class="keyword">return</span> key</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>三、 BoolEncoding </p>
<p>配置Bool参数如何编码</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">enum</span> BoolEncoding &#123;</span><br><span class="line">        /// Encode `<span class="literal">true</span>` as `<span class="number">1</span>` <span class="literal">and</span> `<span class="literal">false</span>` as `<span class="number">0</span>`. This is the <span class="keyword">default</span> behavior.</span><br><span class="line">        <span class="keyword">case</span> numeric</span><br><span class="line">        /// Encode `<span class="literal">true</span>` <span class="literal">and</span> `<span class="literal">false</span>` as <span class="built_in">string</span> literals.</span><br><span class="line">        <span class="keyword">case</span> literal</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(value: Bool)</span> -&gt; <span class="title">String</span> &#123;</span></span><br><span class="line">            <span class="keyword">switch</span> self &#123;</span><br><span class="line">            <span class="keyword">case</span> .numeric:</span><br><span class="line">                <span class="keyword">return</span> value ? <span class="string">"1"</span> : <span class="string">"0"</span></span><br><span class="line">            <span class="keyword">case</span> .literal:</span><br><span class="line">                <span class="keyword">return</span> value ? <span class="string">"true"</span> : <span class="string">"false"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>四、 属性</p>
<ol>
<li>default 返回编码方式是.methodDependent的编码器(URLEncoding)</li>
<li>queryString 返回编码方式是.queryString的编码器(URLEncoding)</li>
<li>httpBody 返回编码方式是.httpBody的编码器(URLEncoding)</li>
<li>destination 目标编码方式 (实例属性)</li>
<li>arrayEncoding 编码使用的array的编码方式 (实例属性)</li>
<li>boolEncoding 编码器编码Bool属性使用的编码方式 (实例属性)</li>
</ol>
<p>五 方法 </p>
<p>实现了编码方法 </p>
<h3 id="JSONEncoding"><a href="#JSONEncoding" class="headerlink" title="JSONEncoding"></a>JSONEncoding</h3><p>使用JSONSerialization 将请求参数编码为JSON格式 ，并将Content type 设置为 application/json</p>
<h2 id="拦截器部分（RequestInterceptor适配、重试）"><a href="#拦截器部分（RequestInterceptor适配、重试）" class="headerlink" title="拦截器部分（RequestInterceptor适配、重试）"></a>拦截器部分（RequestInterceptor适配、重试）</h2><h3 id="RequestAdapter-协议"><a href="#RequestAdapter-协议" class="headerlink" title="RequestAdapter 协议"></a>RequestAdapter 协议</h3><p>可以翻译为请求适配器，可以对URLRequest inspect、ptionally adapt，适配后，会执行completion block。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">RequestAdapter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Inspects and adapts the specified `URLRequest` in some manner and calls the completion handler with the Result.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">adapt</span><span class="params">(<span class="number">_</span> urlRequest: URLRequest, <span class="keyword">for</span> session: Session, completion: @escaping <span class="params">(Result&lt;URLRequest, Error&gt;)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Result-表示结果的枚举"><a href="#Result-表示结果的枚举" class="headerlink" title="Result 表示结果的枚举"></a>Result 表示结果的枚举</h3><p>封装了成功和失败两个关联值的枚举</p>
<h3 id="RetryResult重试枚举"><a href="#RetryResult重试枚举" class="headerlink" title="RetryResult重试枚举"></a>RetryResult重试枚举</h3><p>封装了立即重试(retry)、延迟重试(retryWithDelay，关联了延时时间)、不重试（doNotRetry）、某种错误不重试(doNotRetryWithError，关联了某种类型的错误)</p>
<h3 id="RequestRetrier协议"><a href="#RequestRetrier协议" class="headerlink" title="RequestRetrier协议"></a>RequestRetrier协议</h3><p>RequestRetrier协议封装了：请求被session manager执行后，并遇到错误，是否重试。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">func</span> <span class="selector-tag">retry</span>(_ <span class="attribute">request</span>: Request, for <span class="attribute">session</span>: Session, dueTo <span class="attribute">error</span>: Error, <span class="attribute">completion</span>: <span class="variable">@escaping</span> (RetryResult) -&gt; Void)</span><br></pre></td></tr></table></figure>
<p>当决定重试时，通过completion完成重试</p>
<h3 id="RequestInterceptor-协议"><a href="#RequestInterceptor-协议" class="headerlink" title="RequestInterceptor 协议"></a>RequestInterceptor 协议</h3><p>准守RequestAdapter和RequestRetrier协议。</p>
<h3 id="Adapter-类"><a href="#Adapter-类" class="headerlink" title="Adapter 类"></a>Adapter 类</h3><p>基于闭包的RequestAdapter类型，准守RequestInterceptor协议</p>
<h3 id="Retrier-类"><a href="#Retrier-类" class="headerlink" title="Retrier 类"></a>Retrier 类</h3><p>基于闭包的RequestRetrier，准守RequestInterceptor协议</p>
<h3 id="Interceptor类"><a href="#Interceptor类" class="headerlink" title="Interceptor类"></a>Interceptor类</h3><p>可以使用多个RequestAdapter、RequestRetrier进行拦截，继承于RequestInterceptor。</p>
<p>内部存储多个RequestAdapter、RequestRetrier进行拦截</p>
<h2 id="ServerTrustManager–服务信任管理"><a href="#ServerTrustManager–服务信任管理" class="headerlink" title="ServerTrustManager–服务信任管理"></a>ServerTrustManager–服务信任管理</h2><p>管理 ServerTrustEvaluating和host的映射。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerTrustManager</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// 是否所有host都需要被评估，默认true</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> allHostsMustBeEvaluated: <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// host 与host对应的policies的字典</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> evaluators: [<span class="type">String</span>: <span class="type">ServerTrustEvaluating</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">///返回host对应的评估器(ServerTrustEvaluating)</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">serverTrustEvaluator</span><span class="params">(forHost host: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">ServerTrustEvaluating</span>?;</span><br></pre></td></tr></table></figure>
<h3 id="ServerTrustEvaluating-评估器协议"><a href="#ServerTrustEvaluating-评估器协议" class="headerlink" title="ServerTrustEvaluating 评估器协议"></a>ServerTrustEvaluating 评估器协议</h3><p>描述了评估服务器信任的API </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">evaluate</span><span class="params">(<span class="number">_</span> trust: SecTrust, forHost host: String)</span></span> <span class="keyword">throws</span></span><br></pre></td></tr></table></figure>
<p>评估给定host的trust是否可行</p>
<h3 id="DefaultTrustEvaluator"><a href="#DefaultTrustEvaluator" class="headerlink" title="DefaultTrustEvaluator"></a>DefaultTrustEvaluator</h3><p>使用服务器默认信任评估的评估器，可以控制是否验证挑战(challenge)提供的host</p>
<p>评估思路：</p>
<ol>
<li>host -&gt;SecPolicy </li>
<li>调用SecTrustSetPolicies函数，给SecTrust设置策略</li>
<li>调用SecTrustEvaluateWithError，验证SecTrust</li>
</ol>
<h3 id="RevocationTrustEvaluator-类"><a href="#RevocationTrustEvaluator-类" class="headerlink" title="RevocationTrustEvaluator  类"></a>RevocationTrustEvaluator  类</h3><p>使用默认的和撤销服务信任评估的评估器，继承ServerTrustEvaluating协议。</p>
<p>该信任评估和DefaultTrustEvaluator 的主要区别是创建策略的方法不同，使用的函数是SecPolicyCreateRevocation。</p>
<h3 id="PinnedCertificatesTrustEvaluator"><a href="#PinnedCertificatesTrustEvaluator" class="headerlink" title="PinnedCertificatesTrustEvaluator"></a>PinnedCertificatesTrustEvaluator</h3><p>使用证书评估服务器，只要任何一张固定证书匹配服务器的任何一张证书，就认为服务器是可信的。</p>
<p>自签名证书：</p>
<ol>
<li>调用SecTrustSetAnchorCertificates 函数，将证书添加到trust中。trust包含需要验证的证书、验证使用的策略、可选的验证证书的证书(AnchorCertificates )</li>
<li>SecTrustSetAnchorCertificatesOnly ，必须调用的，如果不调用，只用使用AnchorCertificates验证证书。调用了可以使用其他的证书，比如系统证书？</li>
<li>调用 SecTrustEvaluateWithError函数评估服务器信任</li>
</ol>
<p>正常情况：</p>
<p>判断固定证书是否包含在服务器的证书中，调用Set的 isDisjoint方法。</p>
<p>证书的读取方法 </p>
<ol>
<li>PinnedCertificatesTrustEvaluator初始哈方法中，调用了Bundle.main.af.certificates函数。</li>
<li>Bundle的扩展中有certificates计算属性，读取.cer, CER, .crt, .CRT, .der后缀文件。</li>
</ol>
<h3 id="PublicKeysTrustEvaluator"><a href="#PublicKeysTrustEvaluator" class="headerlink" title="PublicKeysTrustEvaluator"></a>PublicKeysTrustEvaluator</h3><p>使用公钥评估服务器信任。</p>
<h2 id="RedirectHandler-–-重定向处理"><a href="#RedirectHandler-–-重定向处理" class="headerlink" title="RedirectHandler – 重定向处理"></a>RedirectHandler – 重定向处理</h2><p>如何处理“服务端返回的重定向响应”—要求重定向到新的请求。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">func</span> <span class="selector-tag">task</span>(_ <span class="attribute">task</span>: URLSessionTask,</span><br><span class="line">              willBeRedirectedTo <span class="attribute">request</span>: URLRequest,</span><br><span class="line">              for <span class="attribute">response</span>: HTTPURLResponse,</span><br><span class="line">              <span class="attribute">completion</span>: <span class="variable">@escaping</span> (URLRequest?) -&gt; Void)</span><br></pre></td></tr></table></figure>
<h3 id="Redirector-结构体"><a href="#Redirector-结构体" class="headerlink" title="Redirector 结构体"></a>Redirector 结构体</h3><p>是一个便利的RedirectHandler，可以follow、not follow、modify a redirect。</p>
<p>扩展里面做了默认实现，</p>
<ol>
<li>follow，执行completion Block，参数是重定向指定的新请求。</li>
<li>not fllow 执行completion Block，参数是nil</li>
<li>如果是modify，使用modify关联的Closure创建新的请求，然后执行completion Block，参数是修改过的请求。</li>
</ol>
<h2 id="CachedResponseHandler-缓存协议"><a href="#CachedResponseHandler-缓存协议" class="headerlink" title="CachedResponseHandler 缓存协议"></a>CachedResponseHandler 缓存协议</h2><p>初始data task 是否缓存响应。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">func</span> <span class="selector-tag">dataTask</span>(_ <span class="attribute">task</span>: URLSessionDataTask,</span><br><span class="line">                  willCacheResponse <span class="attribute">response</span>: CachedURLResponse,</span><br><span class="line">                  <span class="attribute">completion</span>: <span class="variable">@escaping</span> (CachedURLResponse?) -&gt; Void)</span><br></pre></td></tr></table></figure>
<p>completion 是执行缓存操作的Block，有三种情况</p>
<ol>
<li>服务器提供的缓存响应</li>
<li>修改响应的缓存</li>
<li>nil，不缓存</li>
</ol>
<h3 id="ResponseCacher-结构体"><a href="#ResponseCacher-结构体" class="headerlink" title="ResponseCacher 结构体"></a>ResponseCacher 结构体</h3><p>ResponseCacher是一个便利的缓存处理器（CachedResponseHandler），可以处理缓存、不缓存、修改缓存。</p>
<h2 id="RequestDelegate-请求代理"><a href="#RequestDelegate-请求代理" class="headerlink" title="RequestDelegate 请求代理"></a>RequestDelegate 请求代理</h2><p>执行URLSessionDelegate的方法的类。</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private let fileManager: FileManager</span><br><span class="line">weak var <span class="keyword">state</span>Provider: SessionStateProvider?</span><br></pre></td></tr></table></figure>
<h3 id="SessionStateProvider"><a href="#SessionStateProvider" class="headerlink" title="SessionStateProvider"></a>SessionStateProvider</h3><p>SessionStateProvider协议提供Session的各种状态，包括主要的三要素：信任评估、 重定向、缓存。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serverTrustManager: ServerTrustManager? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">var</span> redirectHandler: RedirectHandler? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">var</span> cachedResponseHandler: CachedResponseHandler? &#123; <span class="keyword">get</span> &#125;</span><br></pre></td></tr></table></figure>
<p>一、SessionStateProvider功能：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SessionStateProvider</span>: <span class="title">AnyObject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">request</span><span class="params">(<span class="keyword">for</span> task: URLSessionTask)</span></span> -&gt; <span class="type">Request</span>? <span class="comment">//创建请求</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">didGatherMetricsForTask</span><span class="params">(<span class="number">_</span> task: URLSessionTask)</span></span> <span class="comment">//度量完成</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">didCompleteTask</span><span class="params">(<span class="number">_</span> task: URLSessionTask)</span></span><span class="comment">//任务完成</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">credential</span><span class="params">(<span class="keyword">for</span> task: URLSessionTask, <span class="keyword">in</span> protectionSpace: URLProtectionSpace)</span></span> -&gt; <span class="type">URLCredential</span>?<span class="comment">//创建凭证</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">cancelRequestsForSessionInvalidation</span><span class="params">(with error: Error?)</span></span><span class="comment">//session非法时，取消请求 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>二、 执行URLSessionDelegate的代理方法 </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">open</span> <span class="selector-tag">func</span> <span class="selector-tag">urlSession</span>(_ <span class="attribute">session</span>: URLSession, didBecomeInvalidWithError <span class="attribute">error</span>: Error?) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">eventMonitor</span>?<span class="selector-class">.urlSession</span>(session, <span class="attribute">didBecomeInvalidWithError</span>: error)</span><br><span class="line"> <span class="selector-tag">stateProvider</span>?<span class="selector-class">.cancelRequestsForSessionInvalidation</span>(<span class="attribute">with</span>: error)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>session无效后，取消请求。</p>
<p>三、 URLSessionTaskDelegate 的代理方法 </p>
<p>插曲，下面是挑战的结构 </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">URLAuthenticationChallenge(挑战)</span><br><span class="line">    URLProtectionSpace(保护空间)  </span><br><span class="line">        realm 认证域</span><br><span class="line">        host  </span><br><span class="line">        port</span><br><span class="line">        authenticationMethod</span><br><span class="line">    proposedCredential: URLCredential(凭证)</span><br><span class="line">    	用户名密码类型凭证</span><br><span class="line">    	证书类型凭证</span><br><span class="line">    	被接受的specified trust</span><br></pre></td></tr></table></figure>
<p>3.1 认证代理方法<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">open</span> <span class="selector-tag">func</span> <span class="selector-tag">urlSession</span>(_ <span class="attribute">session</span>: URLSession,</span><br><span class="line">                         <span class="attribute">task</span>: URLSessionTask,</span><br><span class="line">                         didReceive <span class="attribute">challenge</span>: URLAuthenticationChallenge,</span><br><span class="line">                         <span class="attribute">completionHandler</span>: <span class="variable">@escaping</span> (URLSession.AuthChallengeDisposition, URLCredential?) -&gt; Void)</span><br></pre></td></tr></table></figure></p>
<p>根据挑战URLAuthenticationChallenge，创建凭证URLCredential。调用completionHandler接受挑战，参数是challenge.protectionSpace.authenticationMethod、凭证。</p>
<p>3.1 数据发送代理方法<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession,</span></span></span><br><span class="line"><span class="function"><span class="params">                         task: URLSessionTask,</span></span></span><br><span class="line"><span class="function"><span class="params">                         didSendBodyData bytesSent: Int64,</span></span></span><br><span class="line"><span class="function"><span class="params">                         totalBytesSent: Int64,</span></span></span><br><span class="line"><span class="function"><span class="params">                         totalBytesExpectedToSend: Int64)</span></span></span><br></pre></td></tr></table></figure></p>
<p>3.3  需要请求体代理方法</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">open</span> <span class="selector-tag">func</span> <span class="selector-tag">urlSession</span>(_ <span class="attribute">session</span>: URLSession,</span><br><span class="line">                         <span class="attribute">task</span>: URLSessionTask,</span><br><span class="line">                         needNewBodyStream <span class="attribute">completionHandler</span>: <span class="variable">@escaping</span> (InputStream?) -&gt; Void)</span><br></pre></td></tr></table></figure>
<p>3.4 重定向代理方法</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">open</span> <span class="selector-tag">func</span> <span class="selector-tag">urlSession</span>(_ <span class="attribute">session</span>: URLSession,</span><br><span class="line">                         <span class="attribute">task</span>: URLSessionTask,</span><br><span class="line">                         willPerformHTTPRedirection <span class="attribute">response</span>: HTTPURLResponse,</span><br><span class="line">                         newRequest <span class="attribute">request</span>: URLRequest,</span><br><span class="line">                         <span class="attribute">completionHandler</span>: <span class="variable">@escaping</span> (URLRequest?) -&gt; Void)</span><br></pre></td></tr></table></figure>
<p>3.5 度量完成 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, task: URLSessionTask, didFinishCollecting metrics: URLSessionTaskMetrics)</span></span></span><br></pre></td></tr></table></figure>
<p>3.6 请求完成 </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">open</span> <span class="selector-tag">func</span> <span class="selector-tag">urlSession</span>(_ <span class="attribute">session</span>: URLSession, <span class="attribute">task</span>: URLSessionTask, didCompleteWithError <span class="attribute">error</span>: Error?) &#123;</span><br><span class="line">        <span class="selector-tag">eventMonitor</span>?<span class="selector-class">.urlSession</span>(session, <span class="attribute">task</span>: task, <span class="attribute">didCompleteWithError</span>: error)</span><br></pre></td></tr></table></figure>
<p>四、 URLSessionDataDelegate代理 </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//收到数据</span></span><br><span class="line"><span class="selector-tag">open</span> <span class="selector-tag">func</span> <span class="selector-tag">urlSession</span>(_ <span class="attribute">session</span>: URLSession, <span class="attribute">dataTask</span>: URLSessionDataTask, didReceive <span class="attribute">data</span>: Data)</span><br><span class="line"></span><br><span class="line"><span class="comment">//缓存响应</span></span><br><span class="line"><span class="selector-tag">open</span> <span class="selector-tag">func</span> <span class="selector-tag">urlSession</span>(_ <span class="attribute">session</span>: URLSession,</span><br><span class="line">                         <span class="attribute">dataTask</span>: URLSessionDataTask,</span><br><span class="line">                         willCacheResponse <span class="attribute">proposedResponse</span>: CachedURLResponse,</span><br><span class="line">                         <span class="attribute">completionHandler</span>: <span class="variable">@escaping</span> (CachedURLResponse?) -&gt; Void)</span><br></pre></td></tr></table></figure>
<h3 id="小小节"><a href="#小小节" class="headerlink" title="小小节"></a>小小节</h3><p>SessionDelegate 主要就是执行URLSession的代理。每个代理的工作是</p>
<ol>
<li>调用事件监控对应的方法(EventMonitor)</li>
<li>二是调用SessionStateProvider中定制方法、或者SessionStateProvider中的评估器、重定向器、缓冲器方法。</li>
</ol>
<p>所以，SessionStateProvider中的评估器、重定向器、缓冲器，就是为了将复杂的功能分离出去，独立为模块。</p>
<h2 id="序列化响应"><a href="#序列化响应" class="headerlink" title="序列化响应"></a>序列化响应</h2><h3 id="DataResponseSerializerProtocol-协议"><a href="#DataResponseSerializerProtocol-协议" class="headerlink" title="DataResponseSerializerProtocol 协议"></a>DataResponseSerializerProtocol 协议</h3><p>DataResponseSerializerProtocol 协议</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">DataResponseSerializerProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// The type of serialized object to be created.</span></span><br><span class="line">    associatedtype <span class="type">SerializedObject</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">serialize</span><span class="params">(request: URLRequest?, response: HTTPURLResponse?, data: Data?, error: Error?)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">SerializedObject</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义了序列化的方法 </p>
<h3 id="DownloadResponseSerializerProtocol-协议"><a href="#DownloadResponseSerializerProtocol-协议" class="headerlink" title="DownloadResponseSerializerProtocol 协议"></a>DownloadResponseSerializerProtocol 协议</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">DownloadResponseSerializerProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// The type of serialized object to be created.</span></span><br><span class="line">    associatedtype <span class="type">SerializedObject</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">serializeDownload</span><span class="params">(request: URLRequest?, response: HTTPURLResponse?, fileURL: URL?, error: Error?)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">SerializedObject</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义了下载请求序列化的方法 </p>
<h3 id="ResponseSerializer"><a href="#ResponseSerializer" class="headerlink" title="ResponseSerializer"></a>ResponseSerializer</h3><p>能够处理数据和下载的序列化器</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public protocol ResponseSerializer: DataResponseSerializerProtocol &amp; DownloadResponseSerializerProtocol &#123;</span><br><span class="line">    <span class="comment"><span class="markdown">/// 准备数据</span></span></span><br><span class="line">    <span class="keyword">var</span> dataPreprocessor: DataPreprocessor &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment"><span class="markdown">/// <span class="code">`HTTPMethod`</span>s for which empty response bodies </span>are<span class="markdown"> considered appropriate.</span></span></span><br><span class="line">    <span class="keyword">var</span> emptyRequestMethods: <span class="built_in">Set</span>&lt;HTTPMethod&gt; &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment"><span class="markdown">/// HTTP response codes for which empty response bodies </span>are<span class="markdown"> considered appropriate.</span></span></span><br><span class="line">    <span class="keyword">var</span> emptyResponseCodes: <span class="built_in">Set</span>&lt;Int&gt; &#123; <span class="keyword">get</span> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="DataPreprocessor-数据预处理器"><a href="#DataPreprocessor-数据预处理器" class="headerlink" title="DataPreprocessor 数据预处理器"></a>DataPreprocessor 数据预处理器</h3><p>序列化前的数据处理 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">DataPreprocessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Process           `Data` before it's handled by a serializer.</span></span><br><span class="line">    <span class="comment">/// - Parameter data: The raw `Data` to process.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">preprocess</span><span class="params">(<span class="number">_</span> data: Data)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Data</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ResponseSerializer-协议扩展"><a href="#ResponseSerializer-协议扩展" class="headerlink" title="ResponseSerializer  协议扩展"></a>ResponseSerializer  协议扩展</h3><p>该部分扩展添加了是否允许空响应的识别。</p>
<p>一、 判断请求是否允许空响应,从请求方式判断，Head允许<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">requestAllowsEmptyResponseData</span><span class="params">(<span class="number">_</span> request: URLRequest?)</span></span> -&gt; <span class="type">Bool</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> request.flatMap &#123; $<span class="number">0</span>.httpMethod &#125;</span><br><span class="line">            .flatMap(<span class="type">HTTPMethod</span>.<span class="keyword">init</span>)</span><br><span class="line">            .<span class="built_in">map</span> &#123; emptyRequestMethods.<span class="built_in">contains</span>($<span class="number">0</span>) &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>二、 判断响应是否允许空响应，从响应码判断，204 205 允许<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">responseAllowsEmptyResponseData</span><span class="params">(<span class="number">_</span> response: HTTPURLResponse?)</span></span> -&gt; <span class="type">Bool</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> response.flatMap &#123; $<span class="number">0</span>.statusCode &#125;</span><br><span class="line">            .<span class="built_in">map</span> &#123; emptyResponseCodes.<span class="built_in">contains</span>($<span class="number">0</span>) &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="DataRequest-在序列化文件中的扩展"><a href="#DataRequest-在序列化文件中的扩展" class="headerlink" title="DataRequest 在序列化文件中的扩展"></a>DataRequest 在序列化文件中的扩展</h3><p>一、 默认的只添加序列化完成的闭包，没有序列化功能 </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">func</span> <span class="selector-tag">response</span>(<span class="attribute">queue</span>: DispatchQueue = .main, <span class="attribute">completionHandler</span>: <span class="variable">@escaping</span> (AFDataResponse&lt;Data?&gt;) -&gt; Void) <span class="selector-tag">-</span>&gt; <span class="selector-tag">Self</span></span><br></pre></td></tr></table></figure>
<p>二、 添加一个包含序列化器的完成处理闭包<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@discardableResult</span></span><br><span class="line">public func response&lt;<span class="attribute">Serializer</span>: DataResponseSerializerProtocol&gt;(<span class="attribute">queue</span>: DispatchQueue = .main,</span><br><span class="line">                                                                     <span class="attribute">responseSerializer</span>: Serializer,</span><br><span class="line">                                                                     <span class="attribute">completionHandler</span>: <span class="variable">@escaping</span> (AFDataResponse&lt;Serializer.SerializedObject&gt;) -&gt; Void)</span><br></pre></td></tr></table></figure></p>
<p>内部调用appendResponseSerializer添加了一个序列化的block，block内部的工作 </p>
<ol>
<li>调用responseSerializer的序列化方法 serialize</li>
<li>将序列化的结果封装到result中，包含序列化完的数据、错误</li>
<li>封装DataResponse类型的response，包括request、response、data、serializationDuration、result</li>
<li>如果！(有错误有代理) 将完成block添加的responseSerializerDidComplete中</li>
<li>如果 (有错误有代理) ,调用重试结果</li>
</ol>
<p>重试的逻辑</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">序列化发生错误时，参数是序列化完成hander ：completionHandler</span><br><span class="line">		<span class="string">|</span></span><br><span class="line">		<span class="string">| 调用</span></span><br><span class="line">		<span class="string">|</span></span><br><span class="line">Session-&gt;retryResult函数： retryCompletion</span><br><span class="line">                            <span class="string">|</span></span><br><span class="line">                            <span class="string">| 创建retryCompletion逻辑如下，参数是RetryResult</span></span><br><span class="line">                            <span class="string">|  </span></span><br><span class="line">                            <span class="number">1</span>. 如果不重试didComplete = completionHandler(response)</span><br><span class="line">                            <span class="number">2</span>. 有错误不重试，组装错误，didComplete =completionHandler(response)</span><br><span class="line">                            <span class="number">3</span>. 重试，执行重试操作</span><br><span class="line">                            <span class="number">4</span>. didComplete存储到session的 responseSerializerCompletions</span><br><span class="line">			<span class="string">|</span></span><br><span class="line">			<span class="string">| retryResult函数内部逻辑</span></span><br><span class="line">			<span class="string">|</span></span><br><span class="line">    		<span class="number">1</span>. 取得retrier：RequestRetrier </span><br><span class="line">    		<span class="number">2</span>. 调用retry : 完成block，命名为 retryCompletion1</span><br><span class="line">                            <span class="string">|</span></span><br><span class="line">                            A. 重试没有错误，执行retryCompletion(result)</span><br><span class="line">                            B. 有错误，retryCompletion(.doNotRetryWithError(retryError))</span><br><span class="line">                    <span class="string">|</span></span><br><span class="line">                    <span class="string">| retry函数的逻辑</span></span><br><span class="line">                    <span class="string">|</span></span><br><span class="line">                    执行retryHandler函数： retryCompletion1</span><br></pre></td></tr></table></figure>
<p>上面是最外层，最外层的block最小，越下面的封装，block越大，最内侧的函数完成后执行最大的block，一直向最外层(顶部最小)扩展 </p>
<p>添加一个string类型的序列化器</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">func</span> <span class="selector-tag">responseString</span>(<span class="attribute">queue</span>: DispatchQueue = .main,</span><br><span class="line">                               <span class="attribute">encoding</span>: String.Encoding? = nil,</span><br><span class="line">                               <span class="attribute">completionHandler</span>: <span class="variable">@escaping</span> (AFDataResponse&lt;String&gt;) -&gt; Void) <span class="selector-tag">-</span>&gt; <span class="selector-tag">Self</span></span><br></pre></td></tr></table></figure>
<p>添加一个JSON类型的序列化器</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">func</span> <span class="selector-tag">responseJSON</span>(<span class="attribute">queue</span>: DispatchQueue = .main,</span><br><span class="line">                             <span class="attribute">options</span>: JSONSerialization.ReadingOptions = .allowFragments,</span><br><span class="line">                             <span class="attribute">completionHandler</span>: <span class="variable">@escaping</span> (AFDataResponse&lt;Any&gt;) -&gt; Void) <span class="selector-tag">-</span>&gt; <span class="selector-tag">Self</span></span><br></pre></td></tr></table></figure>
<h2 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h2><p><code>Request</code> is the common superclass of all Alamofire request types and provides common state, delegate, and callback  handling.</p>
<p>request是有状态的，通过内部枚举State表征。状态通过resume、suspend、cancel函数改变。</p>
<h3 id="初始状态部分"><a href="#初始状态部分" class="headerlink" title="初始状态部分"></a>初始状态部分</h3><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">id:</span> UUID 为request提供唯一标识，用于hash、相等</span><br><span class="line"><span class="symbol">underlyingQueue:</span> DispatchQueue 内部异步操作的串行队列</span><br><span class="line"><span class="symbol">serializationQueue:</span> DispatchQueue 序列化使用的队列</span><br><span class="line"><span class="symbol">eventMonitor:</span> EventMonitor?   事件监控</span><br><span class="line"><span class="symbol">interceptor:</span> RequestInterceptor? 拦截器(重试器、适配器)</span><br><span class="line"><span class="symbol">delegate:</span> RequestDelegate?</span><br></pre></td></tr></table></figure>
<h3 id="可变状态部分"><a href="#可变状态部分" class="headerlink" title="可变状态部分"></a>可变状态部分</h3><p>通过结构体MutableState封装，包括进度、重定向、缓存、cURL、响应序列化、凭证、请求、task、metrics、重试次数、错误。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> protectedMutableState: Protector<span class="symbol">&lt;MutableState&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">struct MutableState &#123;</span><br><span class="line">        <span class="comment"><span class="markdown">/// State of </span>the<span class="markdown"> <span class="code">`Request`</span>.</span></span></span><br><span class="line">        <span class="keyword">var</span> state: State = .initialized</span><br><span class="line">        <span class="comment"><span class="markdown">/// <span class="code">`ProgressHandler`</span> and <span class="code">`DispatchQueue`</span> provided for upload progress callbacks.</span></span></span><br><span class="line">        <span class="keyword">var</span> uploadProgressHandler: (handler: ProgressHandler, queue: DispatchQueue)?</span><br><span class="line">        <span class="comment"><span class="markdown">/// <span class="code">`ProgressHandler`</span> and <span class="code">`DispatchQueue`</span> provided for download progress callbacks.</span></span></span><br><span class="line">        <span class="keyword">var</span> downloadProgressHandler: (handler: ProgressHandler, queue: DispatchQueue)?</span><br><span class="line">        <span class="comment"><span class="markdown">/// <span class="code">`RedirectHandler`</span> provided for to handle request redirection.</span></span></span><br><span class="line">        <span class="keyword">var</span> redirectHandler: RedirectHandler?</span><br><span class="line">        <span class="comment"><span class="markdown">/// <span class="code">`CachedResponseHandler`</span> provided to handle response caching.</span></span></span><br><span class="line">        <span class="keyword">var</span> cachedResponseHandler: CachedResponseHandler?</span><br><span class="line">        <span class="comment"><span class="markdown">/// Closure called when </span>the<span class="markdown"> <span class="code">`Request`</span> is able to create </span>a<span class="markdown"> cURL description of itself.</span></span></span><br><span class="line">        <span class="keyword">var</span> cURLHandler: ((<span class="built_in">String</span>) -&gt; Void)?</span><br><span class="line">        <span class="comment"><span class="markdown">/// Response serialization closures that handle response parsing.</span></span></span><br><span class="line">        <span class="keyword">var</span> responseSerializers: [() -&gt; Void] = []</span><br><span class="line">        <span class="comment"><span class="markdown">/// Response serialization completion closures executed once all response serializers </span>are<span class="markdown"> complete.</span></span></span><br><span class="line">        <span class="keyword">var</span> responseSerializerCompletions: [() -&gt; Void] = []</span><br><span class="line">        <span class="comment"><span class="markdown">/// Whether response serializer processing is finished.</span></span></span><br><span class="line">        <span class="keyword">var</span> responseSerializerProcessingFinished = <span class="keyword">false</span></span><br><span class="line">        <span class="comment"><span class="markdown">/// <span class="code">`URLCredential`</span> used for authentication challenges.</span></span></span><br><span class="line">        <span class="keyword">var</span> credential: URLCredential?</span><br><span class="line">        <span class="comment"><span class="markdown">/// All <span class="code">`URLRequest`</span>s created by Alamofire on behalf of </span>the<span class="markdown"> <span class="code">`Request`</span>.</span></span></span><br><span class="line">        <span class="keyword">var</span> requests: [URLRequest] = []</span><br><span class="line">        <span class="comment"><span class="markdown">/// All <span class="code">`URLSessionTask`</span>s created by Alamofire on behalf of </span>the<span class="markdown"> <span class="code">`Request`</span>.</span></span></span><br><span class="line">        <span class="keyword">var</span> tasks: [URLSessionTask] = []</span><br><span class="line">        <span class="comment"><span class="markdown">/// All <span class="code">`URLSessionTaskMetrics`</span> values gathered by Alamofire on behalf of </span>the<span class="markdown"> <span class="code">`Request`</span>. Should correspond</span></span></span><br><span class="line">        <span class="comment"><span class="markdown">/// exactly </span>the<span class="markdown"> </span>the<span class="markdown"> <span class="code">`tasks`</span> created.</span></span></span><br><span class="line">        <span class="keyword">var</span> metrics: [URLSessionTaskMetrics] = []</span><br><span class="line">        <span class="comment"><span class="markdown">/// Number of times any retriers provided retried </span>the<span class="markdown"> <span class="code">`Request`</span>.</span></span></span><br><span class="line">        <span class="keyword">var</span> retryCount = <span class="number">0</span></span><br><span class="line">        <span class="comment"><span class="markdown">/// Final <span class="code">`AFError`</span> for </span>the<span class="markdown"> <span class="code">`Request`</span>, whether from various internal Alamofire calls or as </span>a<span class="markdown"> result of </span>a<span class="markdown"> <span class="code">`task`</span>.</span></span></span><br><span class="line">        <span class="keyword">var</span> error: AFError?</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>内部结构体MutableState 封装可变状态，可能被外部访问</p>
<h3 id="进度部分"><a href="#进度部分" class="headerlink" title="进度部分"></a>进度部分</h3><p>包括进度对象和进度处理器 </p>
<h3 id="重定向、缓存"><a href="#重定向、缓存" class="headerlink" title="重定向、缓存"></a>重定向、缓存</h3><h3 id="response"><a href="#response" class="headerlink" title="response"></a>response</h3><p>返回 lastTask?.response as? HTTPURLResponse</p>
<h3 id="task"><a href="#task" class="headerlink" title="task"></a>task</h3><p>数组存储着task</p>
<p>下面是功能部分 </p>
<h3 id="内部功能"><a href="#内部功能" class="headerlink" title="内部功能"></a>内部功能</h3><p>一 、didFailToCreateURLRequest</p>
<p>didFailToCreateURLRequest  —retryOrFinish – 调用delegate的retryResult—传递的block内部有finish– processNextResponseSerializer– 找出下一个序列化Hander在serializationQueue队列中执行，如果没有下一个句柄，表示序列化完成执行完成序列化Hander responseSerializerCompletions –&gt; cleanup</p>
<p>didCompleteTask 也是调用 retryOrFinish函数 </p>
<h3 id="验证响应"><a href="#验证响应" class="headerlink" title="验证响应"></a>验证响应</h3><p>实现在Validation文件中，验证response code、 response mime type 包含在request accept type中</p>
<h2 id="Protector"><a href="#Protector" class="headerlink" title="Protector"></a>Protector</h2><p>线程安全的设计思想,定义一个Protector的类，类中有一个锁，需要加锁操作放在block中。 </p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">UnfairLock </span><br><span class="line">     unfairLock: os_unfair_lock_t  锁对象</span><br><span class="line">     aroud  输入无参闭包，加锁执行，返回闭包结果</span><br><span class="line">     </span><br><span class="line">     func around&lt;T&gt;<span class="function"><span class="params">(_ closure: () -&gt; T)</span> -&gt;</span> T &#123;</span><br><span class="line">        lock(); </span><br><span class="line">        defer &#123; </span><br><span class="line">             unlock() </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> closure()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Protector </span><br><span class="line">    <span class="keyword">let</span> lock = UnfairLock()</span><br><span class="line">    <span class="keyword">var</span> value: T</span><br><span class="line">    directValue 获取加锁对象</span><br><span class="line">    read 读保护资源的操作 ，入参block<span class="function"><span class="params">(带参数)</span> -&gt;</span>封装<span class="function"><span class="params">(非无参数的block)</span>-&gt;</span>调用锁的aroud方法</span><br><span class="line">    write 写保护资源的操作</span><br></pre></td></tr></table></figure>
<p>好处：</p>
<ol>
<li>不用每个受保护资源都写加锁解锁代码。</li>
<li>泛型使Protector能容纳任何类型。</li>
</ol>
<h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><ol>
<li>创建和管理request</li>
<li>提供了request的基本功能：队列、拦截、信任管理、缓存响应</li>
</ol>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">session: URLSession  创建task使用的session</span></span><br><span class="line"><span class="section">delegate: SessionDelegate 处理URLSessionDelegate的代理，并与Request交互</span></span><br><span class="line"><span class="section">rootQueue: DispatchQueue 内部回调、状态更新的队列，必须是串行队列</span></span><br><span class="line"><span class="section">startRequestsImmediately: Bool 创建request后，是否立即调用resume</span></span><br><span class="line"><span class="section">requestQueue: DispatchQueue 可以异步创建请求，默认使用rootQueue</span></span><br><span class="line"><span class="section">serializationQueue: DispatchQueue  解析响应使用的队列</span></span><br><span class="line"><span class="section">interceptor: RequestInterceptor? 包括重试、适配器</span></span><br><span class="line"><span class="section">serverTrustManager: ServerTrustManager? 评估信任挑战、提供证书、公钥</span></span><br><span class="line"><span class="section">redirectHandler: RedirectHandler?  提供定制化重定向</span></span><br><span class="line"><span class="section">cachedResponseHandler: CachedResponseHandler? 响应缓存管理</span></span><br><span class="line"><span class="section">eventMonitor: CompositeEventMonitor  session事件、请求事件的监控</span></span><br><span class="line"><span class="section">defaultEventMonitors: [EventMonitor]  默认的通知类型监控</span></span><br><span class="line">requestTaskMap = RequestTaskMap() request和task的映射</span><br><span class="line"><span class="section">activeRequests: Set&lt;Request&gt;  激活状态的请求</span></span><br></pre></td></tr></table></figure>
<p>EventMonitor ： 包括session的事件和request生命周期中的事件</p>
<p>SessionDelegate  ：执行URLSessionDelegate的代理</p>
<h2 id="RequestTaskMap"><a href="#RequestTaskMap" class="headerlink" title="RequestTaskMap"></a>RequestTaskMap</h2><p>存储请求和tast的双向映射，两个字典 ，下标操作的新值未空是删除功能</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SessionDelegate</span><br><span class="line">			 fileManager</span><br><span class="line">			 			处理下载文件时候使用</span><br><span class="line">       <span class="keyword">state</span>Provider</span><br><span class="line">       			serverTrustManager</span><br><span class="line">       					 ServerTrustManager类型</span><br><span class="line">       					 管理host ServerTrustEvaluating映射</span><br><span class="line">       			redirectHandler</span><br><span class="line">       			cachedResponseHandler   </span><br><span class="line">       </span><br><span class="line">       eventMonitor</span><br><span class="line">       			包括session的事件和request生命周期中的事件</span><br><span class="line">       	    queue</span><br></pre></td></tr></table></figure>
<h2 id="Extended命名作用域"><a href="#Extended命名作用域" class="headerlink" title="Extended命名作用域"></a>Extended命名作用域</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span>: <span class="title">AlamofireExtended</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">AlamofireExtension</span> <span class="title">where</span> <span class="title">ExtendedType</span> == [<span class="title">SecCertificate</span>] </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> data: [<span class="type">Data</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> type.<span class="built_in">map</span> &#123; <span class="type">SecCertificateCopyData</span>($<span class="number">0</span>) <span class="keyword">as</span> <span class="type">Data</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> publicKeys: [<span class="type">SecKey</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> type.compactMap &#123; $<span class="number">0</span>.af.publicKey &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">AlamofireExtension</span>&lt;<span class="title">ExtendedType</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> type: <span class="type">ExtendedType</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">AlamofireExtended</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> af: <span class="type">AlamofireExtension</span>&lt;<span class="type">ExtendedType</span>&gt;.<span class="type">Type</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">AlamofireExtended</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> af: <span class="type">AlamofireExtension</span>&lt;<span class="type">Self</span>&gt;.<span class="type">Type</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> <span class="type">AlamofireExtension</span>&lt;<span class="type">Self</span>&gt;.<span class="keyword">self</span>&#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>声明Array准守AlamofireExtended协议， AlamofireExtended协议中有一个af属性，类型是AlamofireExtension结构体类型。</p>
<p>也就是说如果让Array准守AlamofireExtended协议，即Array中存在名为af计算属性<br>充当命名空间的作用。</p>
<p>如果想给Array扩展功能，让Array遵守AlamofireExtended，然后给 AlamofireExtension添加扩展功能，通过type成员找到原始期望扩展的类Array。</p>
<p>实际上就是加了个中间层。把系统类的扩展转移到了AlamofireExtension中。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Array ： AlamofireExtended </span><br><span class="line">			  |</span><br><span class="line"><span class="string">			  </span>|</span><br><span class="line">			af属性：AlamofireExtension<span class="variable">&lt;&gt;</span></span><br><span class="line">						  |</span><br><span class="line"><span class="string">						  </span>|</span><br><span class="line">						type：被扩展的类型</span><br><span class="line">						  |</span><br><span class="line"><span class="string">						  </span>|</span><br><span class="line"><span class="variable">&lt;-------AlamofireExtension通过type可以直接找到Array本身</span></span><br></pre></td></tr></table></figure>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AlamofireExtension <span class="keyword">where</span> ExtendedType: <span class="built_in">Array</span> <span class="comment">//只要扩展的是array才能调用的方法</span></span><br></pre></td></tr></table></figure>
<p>下面是使用方法的理解“</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">certificates:[SecCertificate]</span><br><span class="line">certificates<span class="selector-class">.af</span><span class="selector-class">.publicKeys</span> </span><br><span class="line"></span><br><span class="line">extension Array: AlamofireExtended &#123;&#125;</span><br><span class="line">public extension AlamofireExtension where ExtendedType == [SecCertificate] &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 枚举证书，获取公钥</span></span><br><span class="line">    <span class="selector-tag">var</span> publicKeys: [SecKey] &#123;</span><br><span class="line">        return type<span class="selector-class">.compactMap</span> &#123; $<span class="number">0</span><span class="selector-class">.af</span><span class="selector-class">.publicKey</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="学习到的知识"><a href="#学习到的知识" class="headerlink" title="学习到的知识"></a>学习到的知识</h2><h3 id="OptionSet"><a href="#OptionSet" class="headerlink" title="OptionSet"></a>OptionSet</h3><p>OptionSet可以描述位集，每一位表示集合中的一个成员，该协议可以做一些结合的运算。协议有一个rawValue、一些选项。其中选项的值未1、2、4、8 等。以使每个位表示一个选项。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ShippingOptions</span></span>: OptionSet &#123;</span><br><span class="line">    <span class="keyword">let</span> rawValue: Int</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> nextDay    = ShippingOptions(rawValue: <span class="number">1</span> &lt;&lt; <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> secondDay  = ShippingOptions(rawValue: <span class="number">1</span> &lt;&lt; <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> priority   = ShippingOptions(rawValue: <span class="number">1</span> &lt;&lt; <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> standard   = ShippingOptions(rawValue: <span class="number">1</span> &lt;&lt; <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> express: ShippingOptions = [.nextDay, .secondDay]</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> all: ShippingOptions = [.express, .priority, .standard]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>感想：</p>
<ol>
<li>相关的两个成员属性使用元组表示，可以减少属性个数，便于管理</li>
<li>只要有几种可选的处理方式，就使用枚举。枚举应用非常多</li>
<li>函数式编程，消费掉一个参数，生成新的block。</li>
</ol>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>


    
<nav id="article-nav">
    
    
        <a href="/wiki/英语/英语单词/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">英语单词</div>
        </a>
    
</nav>





    
    
        <section id="comments"> 
    <div class="ds-thread" data-thread-key="wiki/IOS/opensource/AlamoFire/alamofile学习/" data-title="AlamoFire 源码浅析" data-url="http://yoursite.com/wiki/IOS/opensource/AlamoFire/alamofile学习/"></div>
    <style>
        #ds-thread #ds-reset .ds-textarea-wrapper {
            background: none;
        }
        #ds-reset .ds-avatar img {
            box-shadow: none;
        }
        #ds-reset .ds-gradient-bg {
            background: #f7f7f7;
        }
        #ds-thread #ds-reset li.ds-tab a {
            border-radius: 3px;
        }
        #ds-thread #ds-reset .ds-post-button {
            color: white;
            border: none;
            box-shadow: none;
            background: #d32;
            text-shadow: none;
            font-weight: normal;
            font-family: 'Microsoft Yahei';
        }
        #ds-thread #ds-reset .ds-post-button:hover {
            color: white;
            background: #DE594C;
        }
        #ds-thread #ds-reset .ds-post-button:active {
            background: #d32;
        }
        #ds-smilies-tooltip ul.ds-smilies-tabs li a.ds-current {
            color: white;
            background: #d32;
            box-shadow: none;
            text-shadow: none;
            font-weight: normal;
        }
    </style>
 </section>
    




<!-- baidu url auto push script -->
<script type="text/javascript">
    !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
</script>     
</section>
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            LJ &copy; 2020 
            <a rel="external nofollow noopener noreferrer" href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png"></a>
            <br> Powered by <a href="http://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>. Theme - <a href="https://github.com/zthxxx/hexo-theme-Wikitten" rel="external nofollow noopener noreferrer" target="_blank">wikitten</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'lijian'};
    (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>



    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
